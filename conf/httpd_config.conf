# Default Config
httpdWorkers                     2
user                             www-data
group                            www-data
priority                         0
autoRestart                      1
chrootPath                       /
enableChroot                     0
inMemBufSize                     60M
swappingDir                      /tmp/lshttpd/swap
autoFix503                       1
gracefulRestartTimeout           300
mime                             conf/mime.properties
showVersionNumber                0
adminEmails                      root@localhost
disableWebAdmin                  0
enableLVE                        0
useIpInProxyHeader		         2
indexFiles                       index.html, index.htm, index.php
# LOGS
errorlog /var/log/error_log {
        logLevel             ERROR
        rollingSize          0
        enableStderrLog      1
}

accesslog /var/log/access_log {
        logReferer           1
        logUserAgent         1
        logFormat            %a %l %u %t "%r" %>s %O "%{Referer}i" "%{User-Agent}i"
        logHeaders           5
        rollingSize          0
}

accesslog /var/log/httpd/homedir.log {
        useServer            0
        logFormat            %O %I
        rollingSize          0
}
# Expires
expires {
    enableExpires           1
    expiresByType           image/*=A604800,text/css=A604800,application/x-javascript=A604800,application/javascript=A604800,font/*=A604800,application/x-font-ttf=A604800
}
# Tuning
tuning{
    maxConnections               10000
    maxSSLConnections            5000
    connTimeout                  300
    maxKeepAliveReq              10000
    smartKeepAlive               0
    keepAliveTimeout             5
    sndBufSize                   0
    rcvBufSize                   0
    gzipStaticCompressLevel      6
    gzipMaxFileSize              10M
    eventDispatcher              best
    maxCachedFileSize            4096
    totalInMemCacheSize          20M
    maxMMapFileSize              256K
    totalMMapCacheSize           40M
    useSendfile                  1
    fileETag                     28
    SSLCryptoDevice              null
    maxReqURLLen                 8192
    maxReqHeaderSize             16380
    maxReqBodySize               2047M
    maxDynRespHeaderSize         8192
    maxDynRespSize               2047M
    enableGzipCompress           1
    enableBrCompress             1
    enableDynGzipCompress        1
    gzipCompressLevel            6
    compressibleTypes            text/*, application/x-javascript, application/xml, application/javascript, image/svg+xml,application/rss+xml
    gzipAutoUpdateStatic         1
    gzipMinFileSize              300
}
# Acsess Deniend dir
accessDenyDir{
    dir                  /
    dir                  /etc/*
    dir                  /dev/*
    dir                  conf/*
    dir                  admin/conf/*
}
# File Accesscontrol
fileAccessControl{
    followSymbolLink                            1
    checkSymbolLink                             0
    requiredPermissionMask                      000
    restrictedPermissionMask                    000
}
# Per Client Connection Limit
perClientConnLimit{
    staticReqPerSec                          0
    dynReqPerSec                             0
    outBandwidth                             0
    inBandwidth                              0
    softLimit                                10000
    hardLimit                                10000
    gracePeriod                              15
    banPeriod                                300
}
# CGIR Limit
CGIRLimit{
    maxCGIInstances                         20
    minUID                                  11
    minGID                                  10
    priority                                0
    CPUSoftLimit                            10
    CPUHardLimit                            50
    memSoftLimit                            1460M
    memHardLimit                            1470M
    procSoftLimit                           400
    procHardLimit                           450
    #cgroups                                 2
}
# ACL
accessControl{
	allow   ALL, 173.245.48.0/20T, 103.21.244.0/22T, 103.22.200.0/22T, 103.31.4.0/22T, 141.101.64.0/18T, 108.162.192.0/18T, 190.93.240.0/20T, 188.114.96.0/20T, 197.234.240.0/22T, 198.41.128.0/17T, 162.158.0.0/15T, 104.16.0.0/13T, 104.24.0.0/14T, 172.64.0.0/13T, 131.0.72.0/22T, 2400:cb00::/32T, 2606:4700::/32T, 2803:f800::/32T, 2405:b500::/32T, 2405:8100::/32T, 2a06:98c0::/29T, 2c0f:f248::/32T
	deny
}
# Rails
railsDefaults{
    binPath
    railsEnv                 1
    maxConns                 5
    env                      LSAPI_MAX_IDLE=60
    initTimeout              60
    retryTimeout             0
    pcKeepAliveTimeout       60
    respBuffer               0
    backlog                  50
    runOnStartUp             1
    extMaxIdleTime           300
    priority                 3
    memSoftLimit             2047M
    memHardLimit             2047M
    procSoftLimit            500
    procHardLimit            600
}
# WSGI
wsgiDefaults{
    binPath
    railsEnv                 1
    maxConns                 5
    env                      LSAPI_MAX_IDLE=60
    initTimeout              60
    retryTimeout             0
    pcKeepAliveTimeout       60
    respBuffer               0
    backlog                  50
    runOnStartUp             1
    extMaxIdleTime           300
    priority                 3
    memSoftLimit             2047M
    memHardLimit             2047M
    procSoftLimit            500
    procHardLimit            600
}
# NODE
nodeDefaults{
    binPath
    railsEnv                 1
    maxConns                 5
    env                      LSAPI_MAX_IDLE=60
    initTimeout              60
    retryTimeout             0
    pcKeepAliveTimeout       60
    respBuffer               0
    backlog                  50
    runOnStartUp             1
    extMaxIdleTime           300
    priority                 3
    memSoftLimit             2047M
    memHardLimit             2047M
    procSoftLimit            500
    procHardLimit            600
}
# MOD CACHE
module cache {
    ls_enabled          1

    checkPrivateCache   1
    checkPublicCache    1
    maxCacheObjSize     10000000
    maxStaleAge         200
    qsCache             1
    reqCookieCache      1
    respCookieCache     1
    ignoreReqCacheCtrl  1
    ignoreRespCacheCtrl 0

    enableCache         0
    expireInSeconds     3600
    enablePrivateCache  0
    privateExpireInSeconds 3600

}
# Recaptcha
lsrecaptcha  {
  enabled                 0
#  siteKey                 Your_SITE_KEY
#  secretKey               Your_SECRET_KEY
  type                    2
  maxTries                3
  allowedRobotHits        3

  botWhiteList  {
# google.com
  }
  regConnLimit            15000
  sslConnLimit            10000
}
# Ext Procsess
extProcessor lsphpwebapps {
    type                            lsapi
    address                         uds://tmp/lshttpd/lsphpwebapps.sock
    autoStart                       2
    path                            /usr/local/bin/lsphp
    runOnStartUp                    3
    extUser                         webapps
    extGroup                        webapps
    # PHP LIMITS
    maxConns                        35
    env                             PHP_LSAPI_CHILDREN=35
    env                             LSPHP_ENABLE_USER_INI=on
    initTimeout                     60
    memSoftLimit                    2047M
    memHardLimit                    2047M
    procSoftLimit                   400
    procHardLimit                   500
    backlog                         100
    instances                       1
    priority                        0
    retryTimeout                    0
    persistConn                     1
    pcKeepAliveTimeout
    respBuffer                      0
}

extProcessor lsphp83 {
    type                            lsapi
    address                         uds://tmp/lshttpd/lsphp83.sock
    autoStart                       1
    path                            /usr/local/bin/lsphp
    # PHP LIMITS
    maxConns                        35
    env                             PHP_LSAPI_CHILDREN=35
    env                             LSPHP_ENABLE_USER_INI=on
    initTimeout                     60
    memSoftLimit                    2047M
    memHardLimit                    2047M
    procSoftLimit                   400
    procHardLimit                   500
    backlog                         100
    instances                       1
    priority                        0
    retryTimeout                    0
    persistConn                     1
    pcKeepAliveTimeout
    respBuffer                      0
}
# Script Hanlder
scriptHandler{
    add lsapi:lsphp83 php
    add lsapi:lsphpwebapps lsphpwebapps
}

# HTTP UNIT EXT
extprocessor 127.0.0.1:8090 {
	type proxy
	address 127.0.0.1:8090
}

# Listeners
listener 64-176-164-139-80 {
 address                 64.176.164.139:80
 secure                  0
}

listener 64-176-164-139-443 {
 address                 64.176.164.139:443
 secure                  1
 keyFile                 /usr/local/lsws/ssl.key/server.key
 certFile                /usr/local/lsws/ssl.crt/server.crt.combined
 certChain               1
 sslProtocol             24
}
# Internal
virtualHost 64.176.164.139 {
  listeners              64-176-164-139-80, 64-176-164-139-443
  user                    webapps
  group                   webapps
  vhRoot                  /var/www/html
  allowSymbolLink         1
  enableScript            1
  restrained              1
  setUIDMode              2
  docRoot                   /var/www/html
  vhDomain                  64.176.164.139
  vhAliases                 *
  adminEmails               root@localhost
  enableGzip                1
  enableIpGeo               1
  rewrite  {
    enable                  1
    autoLoadHtaccess        1
    RewriteFile .htaccess
  }

  vhssl  {
    keyFile                 /usr/local/lsws/ssl.key/server.key
    certFile                /usr/local/lsws/ssl.crt/server.crt.combined
    certChain               1
    sslProtocol             24
  }
}